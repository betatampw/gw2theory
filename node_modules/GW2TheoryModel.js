GW2TheoryModel = function(arParams) {
    
  if (arParams.playerData) {
    this.playerData = arParams.playerData;
  }
  if (arParams.classData) {
    this.classData = arParams.classData;
  }  
  if (arParams.targetData) {
    this.targetData = arParams.targetData;
  }
  if (arParams.options) {
    this.options = arParams.options;
  }  
  
  this.TimeLine = {
    cooldownTimer: {},
    realTime: 0
  };   
  
  this.player = {
    speed: 210, //In combat http://wiki.guildwars2.com/wiki/Movement_speed
  }
}

GW2TheoryModel.prototype.init = function () {
  // get list avalibel skills 

  //for(;;){
  
    var availableSkills  = this.getAvailableSkills();       
    var bestSkill = {
      rating:0
    };
    var skillData = {};
    var allDamageVarians = [];
    //foreach avalibel skill
    for(var i in availableSkills){  
      // chek timeline                        
      if(!this.checkTimeLine(i))
        continue
        
       damageVarians = this.getDamageVarians(i)  // + bonuses
       allDamageVarians = allDamageVarians.concat(damageVarians);
        
       
      // get damage variants  
      skillData = this.getSkillData(i);
      // select best skill
      if(bestSkill.rating<skillData.rating){
        bestSkill = skillData;
      }    
    }
    allDamageVarians.sort(function (i, ii) {
      if (i.damage > ii.damage)
          return -1;
      else if (i.damage < ii.damage)
          return 1;
      else
          return 0;
    });
    
    
    
    // add to timeline
    this.addToTimeLine(bestSkill);
    // add to result
    this.addToResult(bestSkill);
    
    //if(this.TimeLine.realTime > this.options.time) break;
  //};
  console.log(allDamageVarians)
}

GW2TheoryModel.prototype.getAvailableSkills = function () {
  // TODO 
  return this.classData.skills;
}

GW2TheoryModel.prototype.checkTimeLine = function (skillId) {
  if(this.TimeLine.cooldownTimer[skillId] && this.TimeLine.cooldownTimer[skillId]>this.TimeLine.realTime)
    return false;
  return true;  
}

GW2TheoryModel.prototype.getDamageVarians = function (skillId) {
  // TODO 
  
  return [{damage:100,id:skillId},{damage:110,id:skillId}]
}


GW2TheoryModel.prototype.getSkillData = function (skillId) {
  // TODO  OLD FALSE
  var skillData =  this.classData.skills[skillId];
  skillData.rating = skillId
  return skillData;
}

GW2TheoryModel.prototype.addToTimeLine = function (bestSkill) {
  this.TimeLine.cooldownTimer[bestSkill.id] = this.TimeLine.realTime + bestSkill.cd;
  this.TimeLine.realTime+= bestSkill.ct;
  return true;
}

GW2TheoryModel.prototype.addToResult = function (bestSkill) {
  // TODO
  //console.log(this.TimeLine.realTime + ' ' + bestSkill.name)
  return true;
}

exports.GW2TheoryModel = GW2TheoryModel;